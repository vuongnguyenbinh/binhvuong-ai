---
import { siteConfig } from '../../data/site-config';

interface Props {
  title: string;
  description: string;
  image?: string;
  ogImage?: string;
  twitterImage?: string;
  imageAlt?: string;
  ogTitle?: string;
  ogDescription?: string;
  canonicalUrl?: string;
  noIndex?: boolean;
  publishDate?: Date;
  modifiedDate?: Date;
  category?: string;
  tags?: string[];
  type?: 'website' | 'article';
}

const {
  title,
  description,
  image = siteConfig.ogImage,
  ogImage,
  twitterImage,
  imageAlt = title,
  ogTitle,
  ogDescription,
  canonicalUrl,
  noIndex = false,
  publishDate,
  modifiedDate,
  category,
  tags = [],
  type = 'website',
} = Astro.props;

const siteUrl = siteConfig.url;
const currentUrl = canonicalUrl || new URL(Astro.url.pathname, siteUrl).toString();
const resolvedOgImage = new URL(ogImage || image, siteUrl).toString();
const resolvedTwitterImage = new URL(twitterImage || ogImage || image, siteUrl).toString();
const fullTitle = `${title} - ${siteConfig.name}`;
---

<!-- Basic -->
<title>{fullTitle}</title>
<meta name="description" content={description} />
<link rel="canonical" href={currentUrl} />
{noIndex && <meta name="robots" content="noindex, nofollow" />}

<!-- Open Graph -->
<meta property="og:type" content={type === 'article' ? 'article' : 'website'} />
<meta property="og:url" content={currentUrl} />
<meta property="og:title" content={ogTitle || title} />
<meta property="og:description" content={ogDescription || description} />
<meta property="og:image" content={resolvedOgImage} />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:image:alt" content={imageAlt} />
<meta property="og:site_name" content={siteConfig.name} />
<meta property="og:locale" content="vi_VN" />

{
  type === 'article' && (
    <>
      <meta property="article:author" content={siteConfig.author.name} />
      {publishDate && (
        <meta property="article:published_time" content={publishDate.toISOString()} />
      )}
      {modifiedDate && (
        <meta property="article:modified_time" content={modifiedDate.toISOString()} />
      )}
      {category && <meta property="article:section" content={category} />}
      {tags.map((tag) => (
        <meta property="article:tag" content={tag} />
      ))}
    </>
  )
}

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content={ogTitle || title} />
<meta name="twitter:description" content={ogDescription || description} />
<meta name="twitter:image" content={resolvedTwitterImage} />
<meta name="twitter:image:alt" content={imageAlt} />

<!-- JSON-LD Structured Data -->
{
  type === 'article' && (
    <script
      type="application/ld+json"
      set:html={JSON.stringify({
        '@context': 'https://schema.org',
        '@type': 'Article',
        headline: title,
        description: description,
        image: resolvedOgImage,
        datePublished: publishDate?.toISOString(),
        dateModified: modifiedDate?.toISOString() || publishDate?.toISOString(),
        author: {
          '@type': 'Person',
          name: siteConfig.author.name,
          url: siteUrl,
        },
        publisher: {
          '@type': 'Organization',
          name: siteConfig.name,
          logo: {
            '@type': 'ImageObject',
            url: siteConfig.logo,
          },
        },
        mainEntityOfPage: {
          '@type': 'WebPage',
          '@id': currentUrl,
        },
      })}
    />
  )
}

{
  type === 'website' && (
    <script
      type="application/ld+json"
      set:html={JSON.stringify({
        '@context': 'https://schema.org',
        '@type': 'WebSite',
        name: siteConfig.name,
        description: siteConfig.description,
        url: siteUrl,
        author: {
          '@type': 'Person',
          name: siteConfig.author.name,
        },
      })}
    />
  )
}
