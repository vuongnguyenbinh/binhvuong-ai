---
import { siteConfig } from '../../data/site-config';
import { mainNavigation } from '../../data/navigation';
import ThemeToggle from './ThemeToggle.astro';
---

<header
  class="sticky top-0 z-50 backdrop-blur-xl bg-white/80 dark:bg-charcoal/80 border-b border-gray-200 dark:border-white/5"
  id="main-header"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16 lg:h-20">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-3 z-50">
        <img src={siteConfig.logo} alt={siteConfig.name} class="h-10 w-auto" />
        <span class="font-bold text-xl tracking-tight ml-2 text-gray-900 dark:text-white hidden sm:block">
          Binh Vuong <span class="text-bv-red">AI marketing</span>
        </span>
      </a>

      <!-- Desktop Nav -->
      <nav class="hidden lg:flex items-center gap-8">
        {
          mainNavigation.map((item) => (
            <div class="relative group">
              {'children' in item || 'megaMenu' in item ? (
                <>
                  <button class="flex items-center gap-1 text-sm font-medium text-gray-600 dark:text-gray-300 group-hover:text-bv-red transition-colors py-6">
                    {item.label}
                    <svg
                      class="w-4 h-4 transition-transform group-hover:rotate-180"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M19 9l-7 7-7-7"
                      />
                    </svg>
                  </button>

                  {'children' in item && item.children && (
                    <div class="absolute top-full left-0 w-64 bg-white dark:bg-charcoal border border-gray-200 dark:border-white/10 rounded-xl shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 transform translate-y-2 group-hover:translate-y-0 p-2">
                      {item.children.map((child) => (
                        <a
                          href={child.href}
                          class="block px-4 py-3 rounded-lg hover:bg-gray-50 dark:hover:bg-white/5"
                        >
                          <div class="font-semibold text-gray-900 dark:text-white mb-1">
                            {child.label}
                          </div>
                          {'description' in child && (
                            <div class="text-xs text-gray-500">{child.description}</div>
                          )}
                        </a>
                      ))}
                    </div>
                  )}

                  {'megaMenu' in item && 'categories' in item && (
                    <div class="absolute top-full left-1/2 -translate-x-1/2 w-[900px] bg-white dark:bg-charcoal border border-gray-200 dark:border-white/10 rounded-xl shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 transform translate-y-2 group-hover:translate-y-0 p-6 grid grid-cols-3 gap-8">
                      <div>
                        <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4">
                          Chuyên mục
                        </h3>
                        <ul class="space-y-3">
                          {item.categories?.map((cat) => (
                            <li>
                              <a
                                href={cat.href}
                                class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300 hover:text-bv-red transition-colors"
                              >
                                <span>{cat.icon}</span> {cat.label}
                              </a>
                            </li>
                          ))}
                        </ul>
                        <a
                          href="/blog/"
                          class="inline-block mt-4 text-xs font-semibold text-bv-red hover:underline"
                        >
                          Xem tất cả →
                        </a>
                      </div>
                      <div>
                        <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4">
                          Content Hubs
                        </h3>
                        <ul class="space-y-4">
                          {item.hubs?.map((hub) => (
                            <li>
                              <a href={hub.href} class="group/hub block">
                                <div class="font-semibold text-gray-900 dark:text-white group-hover/hub:text-bv-red transition-colors">
                                  {hub.icon} {hub.label}
                                </div>
                                <div class="text-xs text-gray-500">{hub.description}</div>
                              </a>
                            </li>
                          ))}
                        </ul>
                      </div>
                      <div class="bg-gray-50 dark:bg-white/5 rounded-xl p-4">
                        <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3">
                          Bài viết mới
                        </h3>
                        <a href="/blog/" class="text-xs font-bold text-bv-red hover:underline">
                          Xem tất cả →
                        </a>
                      </div>
                    </div>
                  )}

                  {'megaMenu' in item && 'toolCategories' in item && (
                    <div class="absolute top-full left-1/2 -translate-x-1/2 w-[800px] bg-white dark:bg-charcoal border border-gray-200 dark:border-white/10 rounded-xl shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 transform translate-y-2 group-hover:translate-y-0 p-6 grid grid-cols-3 gap-8">
                      {item.toolCategories?.map((toolCat) => (
                        <div>
                          <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4">
                            {toolCat.icon} {toolCat.title}
                          </h3>
                          <ul class="space-y-4">
                            {toolCat.items.map((tool) => (
                              <li>
                                <a href={tool.href} class="group/tool block">
                                  <div class="font-semibold text-gray-900 dark:text-white group-hover/tool:text-bv-red transition-colors">
                                    {tool.label}
                                  </div>
                                  <div class="text-xs text-gray-500">{tool.description}</div>
                                </a>
                              </li>
                            ))}
                          </ul>
                        </div>
                      ))}
                    </div>
                  )}
                </>
              ) : (
                <a
                  href={item.href}
                  class="text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-bv-red transition-colors"
                >
                  {item.label}
                </a>
              )}
            </div>
          ))
        }
      </nav>

      <!-- Header Actions -->
      <div class="flex items-center gap-3">
        <!-- Search Bar -->
        <div
          class="hidden md:flex items-center gap-2 px-4 py-2 bg-gray-100 dark:bg-white/5 border border-gray-200 dark:border-white/10 rounded-lg focus-within:ring-2 focus-within:ring-bv-red/20 transition-all"
        >
          <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
          <input
            type="text"
            placeholder="Tìm kiếm..."
            class="bg-transparent border-none outline-none text-sm w-32 lg:w-40 text-gray-700 dark:text-gray-300 placeholder-gray-400"
          />
        </div>

        <!-- Theme Toggle -->
        <ThemeToggle />

        <!-- CTA -->
        <a
          href="#newsletter"
          class="hidden sm:inline-flex items-center gap-2 px-5 py-2.5 bg-bv-red hover:bg-bv-red-hover text-white text-sm font-semibold rounded-lg transition-all btn-glow"
        >
          Đăng ký
        </a>

        <!-- Mobile Menu Button -->
        <button
          id="mobile-menu-toggle"
          class="lg:hidden w-10 h-10 flex items-center justify-center rounded-lg bg-gray-100 dark:bg-white/5 border border-gray-200 dark:border-white/10 text-gray-600 dark:text-gray-400"
          aria-label="Toggle menu"
        >
          <svg
            id="menu-icon-open"
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
          <svg
            id="menu-icon-close"
            class="w-6 h-6 hidden"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div
    id="mobile-menu"
    class="lg:hidden hidden absolute top-full left-0 w-full bg-white dark:bg-charcoal border-b border-gray-200 dark:border-white/10 shadow-xl max-h-[80vh] overflow-y-auto"
  >
    <div class="px-4 py-6 space-y-6">
      <div class="space-y-4">
        <a href="/" class="block text-base font-medium text-gray-900 dark:text-white">Trang chủ</a>
        <a href="/khoa-hoc/" class="block text-base font-medium text-gray-900 dark:text-white"
          >Khóa học</a
        >
        <a href="/blog/" class="block text-base font-medium text-gray-900 dark:text-white">Blog</a>
        <a href="/tools/" class="block text-base font-medium text-gray-900 dark:text-white"
          >AI & Tools</a
        >
        <a href="/ve-toi/" class="block text-base font-medium text-gray-900 dark:text-white"
          >Về tôi</a
        >
      </div>

      <div class="pt-6 border-t border-gray-100 dark:border-white/5 space-y-4">
        <form class="relative">
          <svg
            class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
          <input
            type="text"
            placeholder="Tìm kiếm..."
            class="w-full pl-10 pr-4 py-3 bg-gray-100 dark:bg-white/5 border border-gray-200 dark:border-white/10 rounded-xl text-sm focus:outline-none focus:border-bv-red"
          />
        </form>
        <a
          href="#newsletter"
          class="flex items-center justify-center gap-2 w-full px-5 py-3 bg-bv-red text-white font-semibold rounded-xl btn-glow"
        >
          Đăng ký nhận tin
        </a>
      </div>
    </div>
  </div>
</header>

<script is:inline>
  const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIconOpen = document.getElementById('menu-icon-open');
  const menuIconClose = document.getElementById('menu-icon-close');

  if (mobileMenuToggle && mobileMenu && menuIconOpen && menuIconClose) {
    mobileMenuToggle.addEventListener('click', () => {
      const isOpen = !mobileMenu.classList.contains('hidden');
      if (isOpen) {
        mobileMenu.classList.add('hidden');
        menuIconOpen.classList.remove('hidden');
        menuIconClose.classList.add('hidden');
      } else {
        mobileMenu.classList.remove('hidden');
        menuIconOpen.classList.add('hidden');
        menuIconClose.classList.remove('hidden');
      }
    });
  }
</script>
